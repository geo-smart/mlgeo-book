
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.6 Resampling Methods &#8212; ML Geo Curriculum</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.7 Statistical Considerations for geoscientific Data and Noise" href="2.7_statistical_considerations.html" />
    <link rel="prev" title="2.5 Data Arrays" href="2.5_Arrays.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/GeoSMART_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ML Geo Curriculum</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../about_this_book/about_this_book.html">
                    Machine Learning in the Geosciences
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About this Book
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://geo-smart.github.io/index.html">
   Geosmart website
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about_this_book/acknowledgements.html">
   Acknowlegments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about_this_book/0_mlgeo_project.html">
   Primer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 1 - Open Source Ecosystem with Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/readme.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.1_open_reproducible_science.html">
   1.1 Open Reproducible Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.2_jupyter_environment.html">
   1.3 Jupyter Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.3_python_environment.html">
   1.3 Python Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.4_computational_environments.html">
   1.4 Computing Environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.5_version_control_git.html">
   1.5 Version Control &amp; GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.6_data_gallery.html">
   1.6 Data Gallery
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 2 - Data Manipulation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2.1_Data_Definitions.html">
   2.1 Data Definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.2_data_formats_rendered.html">
   2.2 Data Formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.3_pandas_rendered.html">
   2.3 Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.4_dataframes_prep.html">
   2.4 DataFrame Exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.5_Arrays.html">
   2.5 Data Arrays
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2.6 Resampling Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.7_statistical_considerations.html">
   2.7 Statistical Considerations for geoscientific Data and Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.8_data_spectral_transforms.html">
   2.8 Spectral Transforms
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.9_filtering_data.html">
   2.9 Filtering Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.10_synthetic_noise.html">
   2.10 Synthetic noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.11_feature_engineering.html">
   2.11 Feature Engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.12_dimensionality_reduction.html">
   2.12 Dimensionality Reduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.13_MLready_data.html">
   2.13 ML-ready data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.20_Final_Project_Assignement.html">
   Assignment:
   <strong>
    Preparing AI-Ready Data for The Final Project
   </strong>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 3 - Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.1_concepts_supervision.html">
   3.1 Concepts in training supervision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.2_classification_regression.html">
   3.2 Classification and Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.3_clustering.html">
   3.3 Clustering: Unsupervied Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.4_binary_classification.html">
   3.4 Binary classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.5_multiclass_classification.html">
   3.5 Multiclass Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.6_logistic_regression.html">
   3.6 Logistic regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.7_randomForest_regression.html">
   3.7 Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.9_ensemble_learning.html">
   3.9 Ensemble learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.10_autoML.html">
   3.10 AutoML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.20_final_project_cml.html">
   3.20 Final Project - Classic Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/Homework_CML.html">
   Homework Classic Machine Learning (50 points)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 4 - Deep Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.0_perceptrons.html">
   4.0 The Perceptron
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.1_neural_networks.html">
   4.1 Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.2_MultiLayerPerceptron.html">
   4.2 Multi Layer Perceptrons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_ModelTraining.html">
   4.3 Model Training
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_PINN.html">
   4.2 Physics-Informed Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_CNN.html">
   4.3 Convolutional Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.5_RNN.html">
   4.4  Recurrent Neural Networks: Processing sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.6_AutoEncoder.html">
   4.5 Auto-encoders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.6_NAS.html">
   4.6 NAS: Network Architecture Search
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 5 - Workflow Management and Reproducibility
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter5-ModelWorkflows/readme.html">
   This chapter focuces on model workflow and ML reproducibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 6- Introduction to Cloud Computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/cloudmaven">
   Browser Access to Cloud Instances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/Denolle-Lab/azure">
   Terraform Access to Cloud Instances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://tljh.jupyter.org/en/latest/">
   Cloud Provider ML Jupyterhubs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/geo-smart/mlgeo-book/main?urlpath=lab/tree/book/Chapter2-DataManipulation/2.6_resampling.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book/issues/new?title=Issue%20on%20page%20%2FChapter2-DataManipulation/2.6_resampling.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book/edit/main/book/Chapter2-DataManipulation/2.6_resampling.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Chapter2-DataManipulation/2.6_resampling.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples-of-resampling-techniques-level-1">
   1. Examples of resampling techniques (Level 1)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#randomization">
     1.1 Randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrapping">
     1.2 Bootstrapping
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#monte-carlo">
     1.3 Monte Carlo
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-resampling-for-robust-model-inference-level-2">
   Using resampling for robust model inference (Level 2)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plate-motion-geodetic-data">
     2.1 Plate Motion - Geodetic Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression">
   2.2 Linear regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     2.3 Bootstrapping
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>2.6 Resampling Methods</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples-of-resampling-techniques-level-1">
   1. Examples of resampling techniques (Level 1)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#randomization">
     1.1 Randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrapping">
     1.2 Bootstrapping
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#monte-carlo">
     1.3 Monte Carlo
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-resampling-for-robust-model-inference-level-2">
   Using resampling for robust model inference (Level 2)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plate-motion-geodetic-data">
     2.1 Plate Motion - Geodetic Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression">
   2.2 Linear regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     2.3 Bootstrapping
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="resampling-methods">
<h1>2.6 Resampling Methods<a class="headerlink" href="#resampling-methods" title="Permalink to this headline">#</a></h1>
<p>Data have natural variability, which we often have to account for.</p>
<p>Among other applications (e.g., uncertainity propagation or assigning confidence intervals to some statistic), <strong>resampling methods</strong> can help us explore this varaibility.</p>
<p>Broadly, resampling refers to any technique where we repeatedly draw observations from some sample.</p>
<!---
Note that the follow statement is specific to resampling for model evaluation:
    Resampling methods involve repeatedly drawing samples from a training set  and re-fitting a model. The collection of best-fit models provides confidence in model fitting.
More broadly, resampling methods refer to any technique where we repeatedly draw observations from some sample. We should use the more broad definition at the introduction of this section.
--->
<p>The lecture introduces resampling techniques in several ways. We explore various fundamental examples of resampling (Level 1) and demonstrate how resampling can be used for model inference of a linear regression (Level 2).</p>
<p>First of all, import some useful modules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">zipfile</span><span class="o">,</span> <span class="nn">io</span><span class="o">,</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fix the random seed for reproducibility. Place it on the top to reproduce the entire notebook exactly once. But use it in every cell to re-run each cells independently.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We define a random generator</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator(PCG64) at 0x318353900
</pre></div>
</div>
</div>
</div>
<section id="examples-of-resampling-techniques-level-1">
<h2>1. Examples of resampling techniques (Level 1)<a class="headerlink" href="#examples-of-resampling-techniques-level-1" title="Permalink to this headline">#</a></h2>
<section id="randomization">
<h3>1.1 Randomization<a class="headerlink" href="#randomization" title="Permalink to this headline">#</a></h3>
<p>As we introduced in class:</p>
<p>Given two datasets, <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>, and a parameter, <span class="math notranslate nohighlight">\(x\)</span>, we can randomly assign observations to either <span class="math notranslate nohighlight">\(A\)</span> or <span class="math notranslate nohighlight">\(B\)</span>, calculate some statistic (e.g., <span class="math notranslate nohighlight">\(x_A - x_B\)</span>), and repeat to build a distribution of that statistic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We begin with two datasets, A and B</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># We then calculate the means of each dataset</span>
<span class="n">mean_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">mean_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The means of A and B are, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_A</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_B</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, respectively.&#39;</span><span class="p">)</span>

<span class="c1"># And, for the sake of illustration, also calculate the difference between these means</span>

<span class="n">diff_means</span> <span class="o">=</span> <span class="n">mean_A</span> <span class="o">-</span> <span class="n">mean_B</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The difference of means is, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_means</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The means of A and B are, 4.874325971290356 and 5.473420405447642, respectively.
The difference of means is, -0.5990944341572852.
</pre></div>
</div>
</div>
</div>
<p>Now, we will want to resample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, how many times do we want to resample?</span>
<span class="n">number_runs</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Next, we create an array that will store the difference of means</span>
<span class="n">array_of_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">number_runs</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># To ease computational burden, let&#39;s declare some variables</span>
<span class="c1"># A combined list of A and B</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
<span class="c1"># Length of A and B</span>
<span class="n">length_A</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For each time we resample, we recalculate the mean and recalculate the difference</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each run:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_runs</span><span class="p">):</span>
    <span class="c1"># Let us shuffle the combined list</span>
    <span class="c1"># Note that shuffle works in place!</span>
    <span class="n">rng</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
    <span class="c1"># Now, split the list into A and B, maintaining their original sizes</span>
    <span class="c1"># Notice the slice syntax!</span>
    <span class="n">new_A</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length_A</span><span class="p">]</span>
    <span class="n">new_B</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="n">length_A</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">combined</span><span class="p">)]</span>
    <span class="c1"># Calculate and store a difference of means</span>
    <span class="n">array_of_diffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">new_A</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">new_B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot up the array of diffs</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">array_of_diffs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Given an alpha of 0.05, can we accept or reject the null hypothesis of no difference in means?</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">lower_critical_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">array_of_diffs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">upper_critical_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">array_of_diffs</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Plot the critical values and the observed value</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">diff_means</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">lower_critical_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">upper_critical_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Difference of means&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Observed difference of means&#39;</span><span class="p">,</span> <span class="s1">&#39;Lower critical value&#39;</span><span class="p">,</span> <span class="s1">&#39;Upper critical value&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="c1"># Show your plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2.6_resampling_12_0.png" src="../_images/2.6_resampling_12_0.png" />
</div>
</div>
</section>
<section id="bootstrapping">
<h3>1.2 Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this headline">#</a></h3>
<p>When bootstrapping, you repeatedly draw observations, <strong>with replacement</strong>, from a dataset. Since you are drawing with replacement, your newly resampled dataset likely will contain duplicate observations from the original sample.</p>
<p>Bootstrapping does not make strong assumptions about the underlying distribution of the dataset.</p>
<p>We will first create correlated data using the numpy function <code class="docutils literal notranslate"><span class="pre">random.multivariate_normal</span></code> (<a class="reference external" href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.multivariate_normal.html">docs here</a>). The mean of both data will be zero and their covariance is -0.75.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We begin with a dataset where two variables are strongly correlated</span>
<span class="n">correlated_data</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.75</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we check that the data is indeed anticorrelated by plotting one against the other</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Observation&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2.6_resampling_16_0.png" src="../_images/2.6_resampling_16_0.png" />
</div>
</div>
<p>We can verify that the Pearson <a class="reference external" href="https://en.wikipedia.org/wiki/Correlation_coefficient">correlation coefficient</a> is close to our target using the numpy function <code class="docutils literal notranslate"><span class="pre">corrcoef</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The correlation matrix of the first and second columns of correlated_data</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.72540304],
       [-0.72540304,  1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the correlation coefficient</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The correlation coefficient is: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The correlation coefficient is: -0.7254030411293304.
</pre></div>
</div>
</div>
</div>
<p>We now take a subset of the data â€” think of the subset as a <em>sample of the true population</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubset</span><span class="o">=</span><span class="mi">10</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">correlated_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nsubset</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.08149552, -0.75473902],
       [-0.15064708, -0.88421426],
       [ 0.03331803,  0.51951422],
       [ 0.58669726,  0.51967288],
       [ 0.42511267,  0.47888931],
       [-0.05371048,  0.15998988],
       [ 0.13428352,  0.24026582],
       [-0.13976786,  0.57151718],
       [-0.74081486,  0.22763649],
       [ 0.02037839, -0.36898269]])
</pre></div>
</div>
</div>
</div>
<p>We can calculate the correlation coefficent of this sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Report the correlation coefficient of the subset</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The correlation coefficient of our sample is: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">subset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">subset</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="c1"># Plot up both the original data and our sample</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">correlated_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">subset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">subset</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;True population&#39;</span><span class="p">,</span> <span class="s1">&#39;Subset&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The correlation coefficient of our sample is: -0.19742697173045337.
</pre></div>
</div>
<img alt="../_images/2.6_resampling_25_1.png" src="../_images/2.6_resampling_25_1.png" />
</div>
</div>
<p>Now, we will bootstrap. Once again, we define a number of runs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_runs</span> <span class="o">=</span><span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<p>Each time we resample, we will calculate and store the correlation coefficent of the resampled data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an array that will keep track of the outputs of our resampling loop. In this case, we just want to record the correlation coefficient of each new sample. </span>
<span class="n">corr_coef_collector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">number_runs</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Let&#39;s also get the length of the subset</span>
<span class="c1"># When bootstrapping, the size of your resampled dataset should match the size of your original sample!</span>
<span class="n">length_sub</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
<span class="n">length_sub</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.08149552, -0.75473902],
       [-0.15064708, -0.88421426],
       [ 0.03331803,  0.51951422],
       [ 0.58669726,  0.51967288],
       [ 0.42511267,  0.47888931],
       [-0.05371048,  0.15998988],
       [ 0.13428352,  0.24026582],
       [-0.13976786,  0.57151718],
       [-0.74081486,  0.22763649],
       [ 0.02037839, -0.36898269]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubset</span><span class="o">=</span><span class="mi">10</span>

<span class="n">subset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.08149552, -0.75473902],
       [-0.15064708, -0.88421426],
       [ 0.03331803,  0.51951422],
       [ 0.58669726,  0.51967288],
       [ 0.42511267,  0.47888931],
       [-0.05371048,  0.15998988],
       [ 0.13428352,  0.24026582],
       [-0.13976786,  0.57151718],
       [-0.74081486,  0.22763649],
       [ 0.02037839, -0.36898269]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubset</span><span class="o">=</span><span class="mi">500</span>
<span class="c1"># Now, for each run</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_runs</span><span class="p">):</span>
    <span class="c1"># We want to draw length_sub samples WITH REPLACEMENT</span>
    <span class="n">new_pairs</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">correlated_data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nsubset</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Calculate and store the correlation coefficient</span>
    <span class="n">corr_coef_collector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">new_pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">new_pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Plot up the corr_coef_collector values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">corr_coef_collector</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Correlation coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>

<span class="c1"># Show the true correlation coefficient</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">correlation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">corr_coef_collector</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;True correlation coefficient&#39;</span><span class="p">,</span> <span class="s1">&#39;Median correlation coefficient&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2.6_resampling_32_0.png" src="../_images/2.6_resampling_32_0.png" />
</div>
</div>
<p>We see that the median Pearson coefficient is not exactly the true Pearson coefficient. Why is that?</p>
<p>What happens if you increase the size of the subset (e.g., your sample of the true population)?</p>
</section>
<section id="monte-carlo">
<h3>1.3 Monte Carlo<a class="headerlink" href="#monte-carlo" title="Permalink to this headline">#</a></h3>
<p>Named after the casino in Monaco, Monte Carlo methods involve <em>simulating new data</em> based on a known (or assumed!) statistical model. Unlike the previous two examples, we do not take draws from an existing sample.</p>
<p>Monte Carlo techniques have many applications. For example, you might see Monte Carlo methods used for probabilistic risk assessment, uncertainty propagation in models, and evaluating complex systemsâ€™ performance. It is especially valuable when dealing with complex geospatial, environmental, or engineering models, where the relationships among variables are not easily captured by simple parametric methods.</p>
<p>Here, we demonstrate Monte Carlo sampling by trying to estimate <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>We begin with a central conceit: that the ratio of the area of a circle to the area of the square is <span class="math notranslate nohighlight">\(\pi/4\)</span>.</p>
<p>We then imagine a circle of radius 1 that is inscribed within a square with sides going from -1 to 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;re going to draw a (x,y) point from a *uniform* distribution and then determine whether that point sits within the circle. If it does, we append it to two lists: points within the circle and points within the square. If not, we append it only to a list of points inside the square</span>
<span class="n">in_circle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">in_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Now, let&#39;s generate many samples</span>
<span class="c1"># Here, we redefine number_runs for efficiency&#39;s sake</span>
<span class="n">number_runs</span> <span class="o">=</span> <span class="mi">50</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_runs</span><span class="p">):</span> <span class="c1"># note that _ allows to avoid creating a variable</span>
    <span class="c1"># Okay, get an x point and a y point</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># How far is this point from the origin?</span>
    <span class="n">origin_dist</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># If origin_dist is less than 1, then this point is inside the circle</span>
    <span class="k">if</span> <span class="n">origin_dist</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">in_circle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_circle</span><span class="p">,</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">in_square</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">in_square</span><span class="p">,</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can visualize what we just did</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">in_square</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">in_square</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">in_circle</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">in_circle</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Points in square&#39;</span><span class="p">,</span> <span class="s1">&#39;Points in circle&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2.6_resampling_37_0.png" src="../_images/2.6_resampling_37_0.png" />
</div>
</div>
<p>We now estimate <span class="math notranslate nohighlight">\(\pi\)</span> by using the length of the number points in the circle and in the quarter as approximation to their area.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us estimate pi</span>

<span class="n">pi_est</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">in_circle</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_square</span><span class="p">))</span>
              
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We estimate the value of pi to be: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pi_est</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We estimate the value of pi to be: 3.28.
</pre></div>
</div>
</div>
</div>
<p>Now with a few runs, we do not get a good answer.</p>
<p>In fact, a Monte Carlo approach needs more runs to <strong>converge</strong>.</p>
<p>You should explore how changing the number of runs changes your estimate of <span class="math notranslate nohighlight">\(\pi\)</span> (and how your calculation converges).</p>
</section>
</section>
<section id="using-resampling-for-robust-model-inference-level-2">
<h2>Using resampling for robust model inference (Level 2)<a class="headerlink" href="#using-resampling-for-robust-model-inference-level-2" title="Permalink to this headline">#</a></h2>
<section id="plate-motion-geodetic-data">
<h3>2.1 Plate Motion - Geodetic Data<a class="headerlink" href="#plate-motion-geodetic-data" title="Permalink to this headline">#</a></h3>
<p>For this tutorial, we use a GPS time series in the Pacific Northwest and explore the long term motions that are due to the Cascadia subduction zone.</p>
<p>We will download GPS time series from the University of Nevada - Reno <span class="xref myst">data center</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The station designation</span>
<span class="n">sta</span><span class="o">=</span><span class="s2">&quot;P395&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;http://geodesy.unr.edu/gps_timeseries/tenv/IGS14/&quot;</span> <span class="o">+</span> <span class="n">sta</span> <span class="o">+</span> <span class="s2">&quot;.tenv&quot;</span><span class="p">)</span>
<span class="n">zip_file_url</span><span class="o">=</span><span class="s2">&quot;http://geodesy.unr.edu/gps_timeseries/tenv/IGS14/&quot;</span><span class="o">+</span> <span class="n">sta</span> <span class="o">+</span> <span class="s2">&quot;.tenv&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zip_file_url</span><span class="p">)</span>


<span class="c1"># create a list of strings with itemized list above</span>
<span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station ID (SSSS)&#39;</span><span class="p">,</span><span class="s1">&#39;date (yymmmdd)&#39;</span><span class="p">,</span>
<span class="s1">&#39;decimal year&#39;</span><span class="p">,</span><span class="s1">&#39;modified Julian day&#39;</span><span class="p">,</span><span class="s1">&#39;GPS week&#39;</span><span class="p">,</span><span class="s1">&#39;day of GPS week&#39;</span><span class="p">,</span>
<span class="s1">&#39;longitude (degrees) of reference meridian&#39;</span><span class="p">,</span><span class="s1">&#39;delta e (m)&#39;</span><span class="p">,</span>
<span class="s1">&#39;delta n (m)&#39;</span><span class="p">,</span><span class="s1">&#39;delta v (m)&#39;</span><span class="p">,</span><span class="s1">&#39;antenna height (m)&#39;</span><span class="p">,</span>
<span class="s1">&#39;sigma e (m)&#39;</span><span class="p">,</span><span class="s1">&#39;sigma n (m)&#39;</span><span class="p">,</span><span class="s1">&#39;sigma v (m)&#39;</span><span class="p">,</span>
<span class="s1">&#39;correlation en&#39;</span><span class="p">,</span><span class="s1">&#39;correlation ev&#39;</span><span class="p">,</span><span class="s1">&#39;correlation nv&#39;</span><span class="p">]</span>
      

<span class="c1"># transform r.content into a pandas dataframe</span>
<span class="c1"># first split r.content with \n separator</span>
<span class="c1"># Decode the content if it&#39;s in bytes</span>
<span class="n">content_str</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="c1"># Split the content by the newline character</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">content_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Now `lines` is a list of strings, each representing a line from the content</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># then transform lines into a pandas dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">])</span>
<span class="c1"># assign column names to df a</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">ll</span>

<span class="c1">#convert columns to numeric</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>http://geodesy.unr.edu/gps_timeseries/tenv/IGS14/P395.tenv
P395 06JAN25 2006.0671 53760 1359 3 -123.9  3347.67917   4987420.31375   53.03678  0.0083 0.00069 0.00105 0.00327 -0.04832  0.01695 -0.31816
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station ID (SSSS)</th>
      <th>date (yymmmdd)</th>
      <th>decimal year</th>
      <th>modified Julian day</th>
      <th>GPS week</th>
      <th>day of GPS week</th>
      <th>longitude (degrees) of reference meridian</th>
      <th>delta e (m)</th>
      <th>delta n (m)</th>
      <th>delta v (m)</th>
      <th>antenna height (m)</th>
      <th>sigma e (m)</th>
      <th>sigma n (m)</th>
      <th>sigma v (m)</th>
      <th>correlation en</th>
      <th>correlation ev</th>
      <th>correlation nv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P395</td>
      <td>06JAN25</td>
      <td>2006.0671</td>
      <td>53760.0</td>
      <td>1359.0</td>
      <td>3.0</td>
      <td>-123.9</td>
      <td>3347.67917</td>
      <td>4.987420e+06</td>
      <td>53.03678</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00327</td>
      <td>-0.04832</td>
      <td>0.01695</td>
      <td>-0.31816</td>
    </tr>
    <tr>
      <th>1</th>
      <td>P395</td>
      <td>06JAN26</td>
      <td>2006.0698</td>
      <td>53761.0</td>
      <td>1359.0</td>
      <td>4.0</td>
      <td>-123.9</td>
      <td>3347.68086</td>
      <td>4.987420e+06</td>
      <td>53.03003</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00104</td>
      <td>0.00321</td>
      <td>-0.04648</td>
      <td>0.00271</td>
      <td>-0.30970</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P395</td>
      <td>06JAN27</td>
      <td>2006.0726</td>
      <td>53762.0</td>
      <td>1359.0</td>
      <td>5.0</td>
      <td>-123.9</td>
      <td>3347.68072</td>
      <td>4.987420e+06</td>
      <td>53.03906</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00326</td>
      <td>-0.02367</td>
      <td>0.00817</td>
      <td>-0.31941</td>
    </tr>
    <tr>
      <th>3</th>
      <td>P395</td>
      <td>06JAN28</td>
      <td>2006.0753</td>
      <td>53763.0</td>
      <td>1359.0</td>
      <td>6.0</td>
      <td>-123.9</td>
      <td>3347.67938</td>
      <td>4.987420e+06</td>
      <td>53.04382</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00324</td>
      <td>-0.03681</td>
      <td>0.00908</td>
      <td>-0.30515</td>
    </tr>
    <tr>
      <th>4</th>
      <td>P395</td>
      <td>06JAN29</td>
      <td>2006.0780</td>
      <td>53764.0</td>
      <td>1360.0</td>
      <td>0.0</td>
      <td>-123.9</td>
      <td>3347.68042</td>
      <td>4.987420e+06</td>
      <td>53.03513</td>
      <td>0.0083</td>
      <td>0.00068</td>
      <td>0.00105</td>
      <td>0.00328</td>
      <td>-0.04815</td>
      <td>0.00619</td>
      <td>-0.33029</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove first value for delta e, delta n, delta v to make relative position with respect to the first time. Add these as new columns</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta e (m)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta e (m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta n (m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta n (m)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta n (m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta v (m)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta v (m)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta v (m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station ID (SSSS)</th>
      <th>date (yymmmdd)</th>
      <th>decimal year</th>
      <th>modified Julian day</th>
      <th>GPS week</th>
      <th>day of GPS week</th>
      <th>longitude (degrees) of reference meridian</th>
      <th>delta e (m)</th>
      <th>delta n (m)</th>
      <th>delta v (m)</th>
      <th>antenna height (m)</th>
      <th>sigma e (m)</th>
      <th>sigma n (m)</th>
      <th>sigma v (m)</th>
      <th>correlation en</th>
      <th>correlation ev</th>
      <th>correlation nv</th>
      <th>new delta e (m)</th>
      <th>new delta n (m)</th>
      <th>new delta v (m)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P395</td>
      <td>06JAN25</td>
      <td>2006.0671</td>
      <td>53760.0</td>
      <td>1359.0</td>
      <td>3.0</td>
      <td>-123.9</td>
      <td>3347.67917</td>
      <td>4.987420e+06</td>
      <td>53.03678</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00327</td>
      <td>-0.04832</td>
      <td>0.01695</td>
      <td>-0.31816</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>P395</td>
      <td>06JAN26</td>
      <td>2006.0698</td>
      <td>53761.0</td>
      <td>1359.0</td>
      <td>4.0</td>
      <td>-123.9</td>
      <td>3347.68086</td>
      <td>4.987420e+06</td>
      <td>53.03003</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00104</td>
      <td>0.00321</td>
      <td>-0.04648</td>
      <td>0.00271</td>
      <td>-0.30970</td>
      <td>0.00169</td>
      <td>-0.00067</td>
      <td>-0.00675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P395</td>
      <td>06JAN27</td>
      <td>2006.0726</td>
      <td>53762.0</td>
      <td>1359.0</td>
      <td>5.0</td>
      <td>-123.9</td>
      <td>3347.68072</td>
      <td>4.987420e+06</td>
      <td>53.03906</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00326</td>
      <td>-0.02367</td>
      <td>0.00817</td>
      <td>-0.31941</td>
      <td>0.00155</td>
      <td>0.00101</td>
      <td>0.00228</td>
    </tr>
    <tr>
      <th>3</th>
      <td>P395</td>
      <td>06JAN28</td>
      <td>2006.0753</td>
      <td>53763.0</td>
      <td>1359.0</td>
      <td>6.0</td>
      <td>-123.9</td>
      <td>3347.67938</td>
      <td>4.987420e+06</td>
      <td>53.04382</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00324</td>
      <td>-0.03681</td>
      <td>0.00908</td>
      <td>-0.30515</td>
      <td>0.00021</td>
      <td>-0.00150</td>
      <td>0.00704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>P395</td>
      <td>06JAN29</td>
      <td>2006.0780</td>
      <td>53764.0</td>
      <td>1360.0</td>
      <td>0.0</td>
      <td>-123.9</td>
      <td>3347.68042</td>
      <td>4.987420e+06</td>
      <td>53.03513</td>
      <td>0.0083</td>
      <td>0.00068</td>
      <td>0.00105</td>
      <td>0.00328</td>
      <td>-0.04815</td>
      <td>0.00619</td>
      <td>-0.33029</td>
      <td>0.00125</td>
      <td>-0.00162</td>
      <td>-0.00165</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;decimal year&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;East displacement&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x319394a90&gt;]
</pre></div>
</div>
<img alt="../_images/2.6_resampling_46_1.png" src="../_images/2.6_resampling_46_1.png" />
</div>
</div>
</section>
</section>
<section id="linear-regression">
<h2>2.2 Linear regression<a class="headerlink" href="#linear-regression" title="Permalink to this headline">#</a></h2>
<p>There is a clean <strong>linear trend</strong> in the horizontal position data over the course of the past 16 years. We can fit the data using:</p>
<p><span class="math notranslate nohighlight">\(E(t) = V_e t + u_e,\)</span><br />
<span class="math notranslate nohighlight">\(N(t) = V_n t + u_n,\)</span></p>
<p>where <span class="math notranslate nohighlight">\(t\)</span> is time. We want to regress the data to find the coefficients <span class="math notranslate nohighlight">\(V_e\)</span>, <span class="math notranslate nohighlight">\(u_e\)</span>, <span class="math notranslate nohighlight">\(V_n\)</span>, <span class="math notranslate nohighlight">\(u_n\)</span>. The displacements are mostly westward, so we will just focus on the East <span class="math notranslate nohighlight">\(E(t)\)</span> component for this exercise. The coefficients <span class="math notranslate nohighlight">\(u_e\)</span> and <span class="math notranslate nohighlight">\(u_n\)</span> are the intercept at <span class="math notranslate nohighlight">\(t=0\)</span>. They are not zero in this case because <span class="math notranslate nohighlight">\(t\)</span> starts in 2006. The coefficients <span class="math notranslate nohighlight">\(V_e\)</span> and <span class="math notranslate nohighlight">\(V_n\)</span> have the dimension of velocities:</p>
<p><span class="math notranslate nohighlight">\(V_e \sim E(t) / t\)</span> , <span class="math notranslate nohighlight">\(V_n \sim N(t) / t\)</span> ,</p>
<p>therefore, we will use this example to discuss a simple <strong>linear regression</strong> and resampling method. We will use both a Scipy function and a Scikit-learn function.</p>
<p>To measure a fit performance, we will measure how well the variance is reduced by fitting the data (scatter points) against the model. The variance is:</p>
<p><span class="math notranslate nohighlight">\(\text{Var}(x) = 1/n \sum_{i=1}^n (x_i-\hat{x})^2\)</span>,</p>
<p>where <span class="math notranslate nohighlight">\(\hat{x}\)</span> is the mean of <span class="math notranslate nohighlight">\(x\)</span>.  When fitting the regression, we predict the values <span class="math notranslate nohighlight">\(x_{pred}\)</span>. The residuals are the differences between the data and the predicted values: <span class="math notranslate nohighlight">\(e = x - x_{pred} \)</span>. <span class="math notranslate nohighlight">\(R^2\)</span> or <i> coefficient of determination</i> is:</p>
<p><span class="math notranslate nohighlight">\(R^2 = 1 - \text{Var}(x-x_{pred}) /\text{Var}(x)  = 1 - \text{Var}(e) /\text{Var}(x) \)</span></p>
<p>The smaller the error, the â€œbetterâ€ the fit (we will discuss later that a fit can be too good!), the closer <span class="math notranslate nohighlight">\(R^2\)</span> is to one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove nans with dropna for the specific delta e column and replace df with the new dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;delta e (m)&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station ID (SSSS)</th>
      <th>date (yymmmdd)</th>
      <th>decimal year</th>
      <th>modified Julian day</th>
      <th>GPS week</th>
      <th>day of GPS week</th>
      <th>longitude (degrees) of reference meridian</th>
      <th>delta e (m)</th>
      <th>delta n (m)</th>
      <th>delta v (m)</th>
      <th>antenna height (m)</th>
      <th>sigma e (m)</th>
      <th>sigma n (m)</th>
      <th>sigma v (m)</th>
      <th>correlation en</th>
      <th>correlation ev</th>
      <th>correlation nv</th>
      <th>new delta e (m)</th>
      <th>new delta n (m)</th>
      <th>new delta v (m)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P395</td>
      <td>06JAN25</td>
      <td>2006.0671</td>
      <td>53760.0</td>
      <td>1359.0</td>
      <td>3.0</td>
      <td>-123.9</td>
      <td>3347.67917</td>
      <td>4.987420e+06</td>
      <td>53.03678</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00327</td>
      <td>-0.04832</td>
      <td>0.01695</td>
      <td>-0.31816</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>P395</td>
      <td>06JAN26</td>
      <td>2006.0698</td>
      <td>53761.0</td>
      <td>1359.0</td>
      <td>4.0</td>
      <td>-123.9</td>
      <td>3347.68086</td>
      <td>4.987420e+06</td>
      <td>53.03003</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00104</td>
      <td>0.00321</td>
      <td>-0.04648</td>
      <td>0.00271</td>
      <td>-0.30970</td>
      <td>0.00169</td>
      <td>-0.00067</td>
      <td>-0.00675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P395</td>
      <td>06JAN27</td>
      <td>2006.0726</td>
      <td>53762.0</td>
      <td>1359.0</td>
      <td>5.0</td>
      <td>-123.9</td>
      <td>3347.68072</td>
      <td>4.987420e+06</td>
      <td>53.03906</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00326</td>
      <td>-0.02367</td>
      <td>0.00817</td>
      <td>-0.31941</td>
      <td>0.00155</td>
      <td>0.00101</td>
      <td>0.00228</td>
    </tr>
    <tr>
      <th>3</th>
      <td>P395</td>
      <td>06JAN28</td>
      <td>2006.0753</td>
      <td>53763.0</td>
      <td>1359.0</td>
      <td>6.0</td>
      <td>-123.9</td>
      <td>3347.67938</td>
      <td>4.987420e+06</td>
      <td>53.04382</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00324</td>
      <td>-0.03681</td>
      <td>0.00908</td>
      <td>-0.30515</td>
      <td>0.00021</td>
      <td>-0.00150</td>
      <td>0.00704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>P395</td>
      <td>06JAN29</td>
      <td>2006.0780</td>
      <td>53764.0</td>
      <td>1360.0</td>
      <td>0.0</td>
      <td>-123.9</td>
      <td>3347.68042</td>
      <td>4.987420e+06</td>
      <td>53.03513</td>
      <td>0.0083</td>
      <td>0.00068</td>
      <td>0.00105</td>
      <td>0.00328</td>
      <td>-0.04815</td>
      <td>0.00619</td>
      <td>-0.33029</td>
      <td>0.00125</td>
      <td>-0.00162</td>
      <td>-0.00165</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;decimal year&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;East displacement&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x3195279a0&gt;]
</pre></div>
</div>
<img alt="../_images/2.6_resampling_50_1.png" src="../_images/2.6_resampling_50_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station ID (SSSS)</th>
      <th>date (yymmmdd)</th>
      <th>decimal year</th>
      <th>modified Julian day</th>
      <th>GPS week</th>
      <th>day of GPS week</th>
      <th>longitude (degrees) of reference meridian</th>
      <th>delta e (m)</th>
      <th>delta n (m)</th>
      <th>delta v (m)</th>
      <th>antenna height (m)</th>
      <th>sigma e (m)</th>
      <th>sigma n (m)</th>
      <th>sigma v (m)</th>
      <th>correlation en</th>
      <th>correlation ev</th>
      <th>correlation nv</th>
      <th>new delta e (m)</th>
      <th>new delta n (m)</th>
      <th>new delta v (m)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P395</td>
      <td>06JAN25</td>
      <td>2006.0671</td>
      <td>53760.0</td>
      <td>1359.0</td>
      <td>3.0</td>
      <td>-123.9</td>
      <td>3347.67917</td>
      <td>4.987420e+06</td>
      <td>53.03678</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00327</td>
      <td>-0.04832</td>
      <td>0.01695</td>
      <td>-0.31816</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>P395</td>
      <td>06JAN26</td>
      <td>2006.0698</td>
      <td>53761.0</td>
      <td>1359.0</td>
      <td>4.0</td>
      <td>-123.9</td>
      <td>3347.68086</td>
      <td>4.987420e+06</td>
      <td>53.03003</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00104</td>
      <td>0.00321</td>
      <td>-0.04648</td>
      <td>0.00271</td>
      <td>-0.30970</td>
      <td>0.00169</td>
      <td>-0.00067</td>
      <td>-0.00675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>P395</td>
      <td>06JAN27</td>
      <td>2006.0726</td>
      <td>53762.0</td>
      <td>1359.0</td>
      <td>5.0</td>
      <td>-123.9</td>
      <td>3347.68072</td>
      <td>4.987420e+06</td>
      <td>53.03906</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00326</td>
      <td>-0.02367</td>
      <td>0.00817</td>
      <td>-0.31941</td>
      <td>0.00155</td>
      <td>0.00101</td>
      <td>0.00228</td>
    </tr>
    <tr>
      <th>3</th>
      <td>P395</td>
      <td>06JAN28</td>
      <td>2006.0753</td>
      <td>53763.0</td>
      <td>1359.0</td>
      <td>6.0</td>
      <td>-123.9</td>
      <td>3347.67938</td>
      <td>4.987420e+06</td>
      <td>53.04382</td>
      <td>0.0083</td>
      <td>0.00069</td>
      <td>0.00105</td>
      <td>0.00324</td>
      <td>-0.03681</td>
      <td>0.00908</td>
      <td>-0.30515</td>
      <td>0.00021</td>
      <td>-0.00150</td>
      <td>0.00704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>P395</td>
      <td>06JAN29</td>
      <td>2006.0780</td>
      <td>53764.0</td>
      <td>1360.0</td>
      <td>0.0</td>
      <td>-123.9</td>
      <td>3347.68042</td>
      <td>4.987420e+06</td>
      <td>53.03513</td>
      <td>0.0083</td>
      <td>0.00068</td>
      <td>0.00105</td>
      <td>0.00328</td>
      <td>-0.04815</td>
      <td>0.00619</td>
      <td>-0.33029</td>
      <td>0.00125</td>
      <td>-0.00162</td>
      <td>-0.00165</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now let&#39;s find the trends and detrend the data.</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="c1"># linear regression such that: displacement = Velocity * time</span>
<span class="c1"># velocity in the East component.</span>

<span class="n">Ve</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;decimal year&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">])</span>
<span class="c1"># horizontal plate motion:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sta</span><span class="p">,</span><span class="s2">&quot;overall plate motion there&quot;</span><span class="p">,</span><span class="n">Ve</span><span class="p">,</span><span class="s1">&#39;m/year&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameters: Coefficient of determination </span><span class="si">%f</span><span class="s2">4.2, P-value </span><span class="si">%f</span><span class="s2">4.2, standard deviation of errors </span><span class="si">%f</span><span class="s2">4.2&quot;</span>\
      <span class="o">%</span><span class="p">(</span><span class="n">r_value</span><span class="p">,</span><span class="n">p_value</span><span class="p">,</span><span class="n">std_err</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P395 overall plate motion there -0.0064397312911273945 m/year
parameters: Coefficient of determination -0.9970084.2, P-value 0.0000004.2, standard deviation of errors 0.0000064.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="c1"># convert the data into numpy arrays.</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new delta e (m)&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="c1"># reshaping was necessary to be an argument of Linear regress</span>
<span class="c1"># E = np.asarray(df[&#39;east&#39;][df[&#39;station&#39;]==sta]).reshape(-1, 1)# reshaping was necessary to be an argument of Linear regress</span>
<span class="c1"># make a new time array</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;decimal year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># perform the linear regression. First we will use the entire available data</span>
<span class="n">regr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1"># we will first perform the fit:</span>
<span class="n">regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">E</span><span class="p">)</span>
<span class="c1"># We will first predict the fit:</span>
<span class="n">Epred</span><span class="o">=</span><span class="n">regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> 

<span class="c1"># The coefficients</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coefficient / Velocity eastward (mm/year): &#39;</span><span class="p">,</span> <span class="n">regr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient / Velocity eastward (mm/year):  -0.006439731291127403
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x318690940&gt;]
</pre></div>
</div>
<img alt="../_images/2.6_resampling_55_2.png" src="../_images/2.6_resampling_55_2.png" />
</div>
</div>
<p>To evaluate the errors of the model fit using the module <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>, we will use the following function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="c1"># The mean squared error</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean squared error (mm): </span><span class="si">%.2f</span><span class="s1">&#39;</span>
      <span class="o">%</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">Epred</span><span class="p">))</span>
<span class="c1"># The coefficient of determination: 1 is the perfect prediction</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coefficient of determination: </span><span class="si">%.2f</span><span class="s1">&#39;</span>
      <span class="o">%</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">Epred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean squared error (mm): 0.00
Coefficient of determination: 0.99
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>2.3 Bootstrapping<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Now we will use again bootstrapping to estimate the slope of the regression over many resampled data.</p>
<p>Scikit-learn seems to have deprecated the bootstrap function, but we can find <code class="docutils literal notranslate"><span class="pre">resample</span></code> in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> module. Make sure you use <code class="docutils literal notranslate"><span class="pre">replace=True</span></code>.
For reproducible results, you can select a fixed <code class="docutils literal notranslate"><span class="pre">random_state=int</span></code> to be kept in the workflow. Usually bootstrapping is done over many times (unlike K-fold cross validation).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>
<span class="n">k</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="c1"># initalize a vector to store the regression values</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">r2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">iik</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>    
    <span class="n">ii</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)),</span><span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">n_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span><span class="c1"># new indices</span>
    <span class="n">E_b</span><span class="p">,</span> <span class="n">t_b</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="c1"># now fit the data on the training set.</span>
    <span class="n">regr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="c1"># Fit on training data:</span>
    <span class="n">regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">t_b</span><span class="p">,</span><span class="n">E_b</span><span class="p">)</span>
    <span class="n">Epred_val</span><span class="o">=</span><span class="n">regr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># test on the validation set.</span>

    <span class="c1"># The coefficients</span>
    <span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">regr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

<span class="c1"># the data shows clearly a trend, so the predictions of the trends are close to each other:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean of the velocity estimates </span><span class="si">%f</span><span class="s2">4.2 and the standard deviation </span><span class="si">%f</span><span class="s2">4.2&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vel</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">vel</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of eastward velocities (mm/year)&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># only show a few values in the x-axis</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean of the velocity estimates -0.0064404.2 and the standard deviation 0.0000064.2
</pre></div>
</div>
<img alt="../_images/2.6_resampling_59_1.png" src="../_images/2.6_resampling_59_1.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter2-DataManipulation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="2.5_Arrays.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2.5 Data Arrays</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2.7_statistical_considerations.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2.7 Statistical Considerations for geoscientific Data and Noise</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By eScience Institute, University of Washington<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>