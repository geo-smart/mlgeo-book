
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.3 Pandas &#8212; ML Geo Curriculum</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.4 Data Arrays" href="2.4_Arrays.html" />
    <link rel="prev" title="2.2 Data Formats" href="2.2_data_formats_rendered.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/GeoSMART_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ML Geo Curriculum</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../about_this_book/about_this_book.html">
                    Machine Learning in the Geosciences
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About this Book
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://geo-smart.github.io/index.html">
   Geosmart website
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about_this_book/acknowledgements.html">
   Acknowlegments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about_this_book/0_mlgeo_project.html">
   Primer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 1 - Open Source Ecosystem with Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/readme.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.1_open_reproducible_science.html">
   1.1 Open Reproducible Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.2_jupyter_environment.html">
   1.3 Jupyter Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.3_python_environment.html">
   1.3 Python Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.4_computational_environments.html">
   1.4 Computing Environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.5_version_control_git.html">
   1.5 Version Control &amp; GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter1-GettingStarted/1.6_data_gallery.html">
   1.6 Data Gallery
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 2 - Data Manipulation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="2.1_Data_Definitions.html">
   2.1 Data Definitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.2_data_formats_rendered.html">
   2.2 Data Formats
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2.3 Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.4_Arrays.html">
   2.4 Data Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.5_resampling.html">
   2.5 Resampling Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.7_data_spectral_transforms.html">
   2.7 Spectral Transforms
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.8_statistical_considerations.html">
   2.8 Statistical Considerations for geoscientific Data and Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.9_feature_engineering.html">
   2.9 Feature engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.10_dimensionality_reduction.html">
   2.10 Dimensionality Reduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2.11_MLready_data.html">
   2.11 ML-ready data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 3 - Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.1_clustering.html">
   3.1 Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.2_classification_regression.html">
   3.2 Classification and Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.3_binary_classification.html">
   3.3 Binary classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.4_multiclass_classification.html">
   3.4 Multiclass Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.5_logistic_regression.html">
   3.5 Logistic regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.6_randomForest_regression.html">
   3.6 Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.7_hyperparameter_tuning.html">
   3.7 Hyperparameter Tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.8_ensemble_learning.html">
   3.8 Ensemble learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter3-MachineLearning/3.9_autoML.html">
   3.9 AutoML
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 4 - Deep Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.0_perceptrons.html">
   4.0 The Perceptron
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.1_neural_networks.html">
   4.1 Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.2_MultiLayerPerceptron.html">
   4.2 Multi Layer Perceptrons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_ModelTraining.html">
   4.3 Model Training
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_PINN.html">
   4.2 Physics-Informed Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.3_CNN.html">
   4.3 Convolutional Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.5_RNN.html">
   4.4  Recurrent Neural Networks: Processing sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.6_AutoEncoder.html">
   4.5 Auto-encoders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter4-DeepLearning/mlgeo_4.6_NAS.html">
   4.6 NAS: Network Architecture Search
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 5 - Workflow Management and Reproducibility
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Chapter5-ModelWorkflows/readme.html">
   This chapter focuces on model workflow and ML reproducibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapter 6- Introduction to Cloud Computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/cloudmaven">
   Browser Access to Cloud Instances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/Denolle-Lab/azure">
   Terraform Access to Cloud Instances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://tljh.jupyter.org/en/latest/">
   Cloud Provider ML Jupyterhubs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/glossary.html">
   Glossaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/geo-smart/mlgeo-book/main?urlpath=lab/tree/book/Chapter2-DataManipulation/2.3_pandas_rendered.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book/issues/new?title=Issue%20on%20page%20%2FChapter2-DataManipulation/2.3_pandas_rendered.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/geo-smart/mlgeo-book/edit/main/book/Chapter2-DataManipulation/2.3_pandas_rendered.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Chapter2-DataManipulation/2.3_pandas_rendered.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   2.3 Pandas
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pandas-fundamentals">
   1 Pandas Fundamentals
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basics">
     1.1 Basics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-a-dataframe-from-a-csv-file">
     1.2 Reading a DataFrame from a CSV file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-pandas-with-python">
     1.3 Manipulating Pandas with Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#classic-functions">
       Classic functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lambda-functions">
       Lambda functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-2-conditional-logic-for-earthquake-magnitude">
       Example 2: Conditional Logic for Earthquake Magnitude
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#intermediate-manipulation-with-pandas">
       1.4 Intermediate Manipulation with Pandas
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-time-series-data-manipulation-with-lambda-functions">
       1.5 Advanced: Time Series Data Manipulation with Lambda Functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#aggregating-multiple-columns-with-multiple-functions">
         Aggregating Multiple Columns with Multiple Functions
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapping-using-plotly">
     2.4 Mapping using Plotly
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-pandas-from-a-generic-text-file">
   3 Create a Pandas from a generic text file.
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   4: Exercise
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#csv-vs-parquet">
   4. CSV vs Parquet
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>2.3 Pandas</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   2.3 Pandas
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pandas-fundamentals">
   1 Pandas Fundamentals
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basics">
     1.1 Basics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-a-dataframe-from-a-csv-file">
     1.2 Reading a DataFrame from a CSV file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulating-pandas-with-python">
     1.3 Manipulating Pandas with Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#classic-functions">
       Classic functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lambda-functions">
       Lambda functions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-2-conditional-logic-for-earthquake-magnitude">
       Example 2: Conditional Logic for Earthquake Magnitude
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#intermediate-manipulation-with-pandas">
       1.4 Intermediate Manipulation with Pandas
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#advanced-time-series-data-manipulation-with-lambda-functions">
       1.5 Advanced: Time Series Data Manipulation with Lambda Functions
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#aggregating-multiple-columns-with-multiple-functions">
         Aggregating Multiple Columns with Multiple Functions
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapping-using-plotly">
     2.4 Mapping using Plotly
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-pandas-from-a-generic-text-file">
   3 Create a Pandas from a generic text file.
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise">
   4: Exercise
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#csv-vs-parquet">
   4. CSV vs Parquet
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pandas">
<h1>2.3 Pandas<a class="headerlink" href="#pandas" title="Permalink to this headline">#</a></h1>
<p>This section aims to provide new skills in python to handle structured, tabular data.</p>
<p>Learning outcome:</p>
<ul class="simple">
<li><p>Manipulation of data frames (describing, filtering, …)</p></li>
<li><p>Learn about Lambda functions</p></li>
<li><p>Intro to datetime objects</p></li>
<li><p>Plotting data from data frames (histograms and maps)</p></li>
<li><p>Introduction to Plotly</p></li>
<li><p>Introduction to CSV &amp; Parquet</p></li>
</ul>
<p>This tutorial can be offered in a 2-hour course. Sections are labeled as Level 1, 2, 3 in Section 1, 2, 3, and instructors may choose to leave higher levels for asynchronous, self-guided learning.</p>
<p>We will work on several structured data sets: sensor metadata, seismic data product (earthquake catalog).</p>
<p>First, we import all the modules we need:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</pre></div>
</div>
</div>
</div>
<p>This notebook uses <code class="docutils literal notranslate"><span class="pre">plotly</span></code> to make interactive plots</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install plotly
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="c1"># pio.renderers.default = &#39;vscode&#39; # writes as standalone html, </span>
<span class="c1"># pio.renderers.default = &#39;iframe&#39; # writes files as standalone html, </span>
<span class="c1"># pio.renderers.default = &#39;png&#39; # writes files as standalone png, </span>
<span class="c1"># try notebook, jupyterlab, png, vscode, iframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: plotly in /Users/marinedenolle/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages (5.17.0)
Requirement already satisfied: tenacity&gt;=6.2.0 in /Users/marinedenolle/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages (from plotly) (8.2.3)
Requirement already satisfied: packaging in /Users/marinedenolle/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages (from plotly) (23.2)

<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> A new release of pip is available: <span class=" -Color -Color-Red">23.3.1</span> -&gt; <span class=" -Color -Color-Green">24.2</span>
<span class=" -Color -Color-Bold">[</span><span class=" -Color -Color-Blue">notice</span><span class=" -Color -Color-Bold">]</span> To update, run: <span class=" -Color -Color-Green">pip install --upgrade pip</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pandas-fundamentals">
<h1>1 Pandas Fundamentals<a class="headerlink" href="#pandas-fundamentals" title="Permalink to this headline">#</a></h1>
<section id="basics">
<h2>1.1 Basics<a class="headerlink" href="#basics" title="Permalink to this headline">#</a></h2>
<p>Pandas are composed of <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. <code class="docutils literal notranslate"><span class="pre">Series</span></code> are columns with attributes or keys. The <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is a multi-dimensional table made up of <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p>We can create a DataFrame composed of series from scratch using Python dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;temperature&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
    <span class="s1">&#39;precipitation&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">my_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_pd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   temperature  precipitation
0           36              3
1           37              1
2           30              0
3           50              0
</pre></div>
</div>
</div>
</div>
<p>Each (key,value) item in the dataframe corresponds to a value in <code class="docutils literal notranslate"><span class="pre">data</span></code>. To get the keys of the dataframe, type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_pd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;temperature&#39;, &#39;precipitation&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>get a specific <code class="docutils literal notranslate"><span class="pre">Series</span></code> (different from the array)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_pd</span><span class="o">.</span><span class="n">temperature</span><span class="p">[:])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">my_pd</span><span class="o">.</span><span class="n">temperature</span><span class="p">[:]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    36
1    37
2    30
3    50
Name: temperature, dtype: int64
&lt;class &#39;pandas.core.series.Series&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>to get the <em>value</em> of a specific key (e.g., temperature), at a specific index (e.g., 2) type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_pd</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">my_pd</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
&lt;class &#39;numpy.int64&#39;&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-a-dataframe-from-a-csv-file">
<h2>1.2 Reading a DataFrame from a CSV file<a class="headerlink" href="#reading-a-dataframe-from-a-csv-file" title="Permalink to this headline">#</a></h2>
<p>We can read a pandas directly from a standard file. We will download a catalog of earthquakes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">gist_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="o">!</span>wget <span class="s2">&quot;https://gist.githubusercontent.com/UW-MLGEO/MLGEO-dataset/main/data/Global_Quakes_IRIS.csv&quot;</span>
<span class="n">ff</span> <span class="o">=</span> <span class="s2">&quot;Global_Quakes_IRIS.csv&quot;</span>
<span class="n">quake</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2024-10-04 06:23:53--  https://gist.githubusercontent.com/UW-MLGEO/MLGEO-dataset/main/data/Global_Quakes_IRIS.csv
Resolving gist.githubusercontent.com (gist.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...
Connecting to gist.githubusercontent.com (gist.githubusercontent.com)|185.199.109.133|:443... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://gist.github.com/UW-MLGEO/MLGEO-dataset/main/data/Global_Quakes_IRIS.csv [following]
--2024-10-04 06:23:53--  https://gist.github.com/UW-MLGEO/MLGEO-dataset/main/data/Global_Quakes_IRIS.csv
Resolving gist.github.com (gist.github.com)... 140.82.116.3
Connecting to gist.github.com (gist.github.com)|140.82.116.3|:443... connected.
HTTP request sent, awaiting response... 404 Not Found
2024-10-04 06:23:53 ERROR 404: Not Found.
</pre></div>
</div>
</div>
</div>
<p>Now you use the <code class="docutils literal notranslate"><span class="pre">head</span></code> function to display what is in the file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># enter answer here</span>
<span class="n">quake</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>magnitude</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-07-02 06:04:03.570</td>
      <td>-13.6098</td>
      <td>166.6541</td>
      <td>34400.0</td>
      <td>6.3</td>
      <td>VANUATU ISLANDS</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-07-04 21:55:52.370</td>
      <td>39.6611</td>
      <td>142.5792</td>
      <td>30100.0</td>
      <td>6.3</td>
      <td>NEAR EAST COAST OF HONSHU</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-07-10 11:43:33.000</td>
      <td>11.1664</td>
      <td>146.0823</td>
      <td>16900.0</td>
      <td>6.3</td>
      <td>SOUTH OF MARIANA ISLANDS</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010-07-12 00:11:20.060</td>
      <td>-22.2789</td>
      <td>-68.3159</td>
      <td>109400.0</td>
      <td>6.2</td>
      <td>NORTHERN CHILE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010-07-14 08:32:21.850</td>
      <td>-38.0635</td>
      <td>-73.4649</td>
      <td>25700.0</td>
      <td>6.6</td>
      <td>NEAR COAST OF CENTRAL CHILE</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Display the depth using two ways to use the pandas object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quake</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        34400.0
1        30100.0
2        16900.0
3       109400.0
4        25700.0
          ...   
1780     10000.0
1781    105000.0
1782    608510.0
1783     10000.0
1784     35440.0
Name: depth, Length: 1785, dtype: float64
0        34400.0
1        30100.0
2        16900.0
3       109400.0
4        25700.0
          ...   
1780     10000.0
1781    105000.0
1782    608510.0
1783     10000.0
1784     35440.0
Name: depth, Length: 1785, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Calculate basic statistic of the data using the function <code class="docutils literal notranslate"><span class="pre">describe</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1785.000000</td>
      <td>1785.000000</td>
      <td>1785.000000</td>
      <td>1785.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.840700</td>
      <td>40.608674</td>
      <td>82773.187675</td>
      <td>6.382403</td>
    </tr>
    <tr>
      <th>std</th>
      <td>30.579308</td>
      <td>125.558363</td>
      <td>146988.302031</td>
      <td>0.429012</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-69.782500</td>
      <td>-179.957200</td>
      <td>0.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-19.905100</td>
      <td>-73.832200</td>
      <td>12000.000000</td>
      <td>6.100000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-4.478900</td>
      <td>113.077800</td>
      <td>24400.000000</td>
      <td>6.300000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>27.161700</td>
      <td>145.305700</td>
      <td>58000.000000</td>
      <td>6.600000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>74.391800</td>
      <td>179.998100</td>
      <td>685500.000000</td>
      <td>9.100000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Calculate mean and median of specific <code class="docutils literal notranslate"><span class="pre">Series</span></code>, for example depth.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer it here</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>82773.18767507003
24400.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="manipulating-pandas-with-python">
<h2>1.3 Manipulating Pandas with Python<a class="headerlink" href="#manipulating-pandas-with-python" title="Permalink to this headline">#</a></h2>
<section id="classic-functions">
<h3>Classic functions<a class="headerlink" href="#classic-functions" title="Permalink to this headline">#</a></h3>
<p>We will now practice how to modify the content of the DataFrame using functions. We will take the example where we want to change the depth values from meters to kilometers. First we can define this operation as a function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this function converts a value in meters to a value in kilometers</span>
<span class="n">m2km</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># this is defined as a global variable</span>
<span class="k">def</span> <span class="nf">meters2kilometers</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="n">m2km</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now test it using the first element of the quake DataFrame</span>
<span class="n">meters2kilometers</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>34.4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this function converts a value in meters to a value in kilometers</span>
<span class="k">def</span> <span class="nf">meters2kilometers2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">m2km</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># this is defined as a global variable</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="n">m2km</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define another function that uses a local instead of global variable</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the meters2kilometers2 function to the &#39;depth&#39; column and add it as a new column &#39;depth_km&#39; to the quake DataFrame</span>
<span class="n">quake</span><span class="p">[</span><span class="s1">&#39;depth_km&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quake</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">meters2kilometers2</span><span class="p">)</span>

<span class="c1"># Display the first few rows to verify the new column</span>
<span class="n">quake</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>magnitude</th>
      <th>description</th>
      <th>depth_km</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-07-02 06:04:03.570</td>
      <td>-13.6098</td>
      <td>166.6541</td>
      <td>34400.0</td>
      <td>6.3</td>
      <td>VANUATU ISLANDS</td>
      <td>34.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-07-04 21:55:52.370</td>
      <td>39.6611</td>
      <td>142.5792</td>
      <td>30100.0</td>
      <td>6.3</td>
      <td>NEAR EAST COAST OF HONSHU</td>
      <td>30.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-07-10 11:43:33.000</td>
      <td>11.1664</td>
      <td>146.0823</td>
      <td>16900.0</td>
      <td>6.3</td>
      <td>SOUTH OF MARIANA ISLANDS</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010-07-12 00:11:20.060</td>
      <td>-22.2789</td>
      <td>-68.3159</td>
      <td>109400.0</td>
      <td>6.2</td>
      <td>NORTHERN CHILE</td>
      <td>109.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010-07-14 08:32:21.850</td>
      <td>-38.0635</td>
      <td>-73.4649</td>
      <td>25700.0</td>
      <td>6.6</td>
      <td>NEAR COAST OF CENTRAL CHILE</td>
      <td>25.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="lambda-functions">
<h3>Lambda functions<a class="headerlink" href="#lambda-functions" title="Permalink to this headline">#</a></h3>
<p>We now discuss the <strong>lambda</strong> functions.</p>
<ul class="simple">
<li><p>Lambda functions are small, anonymous functions in Python.</p></li>
<li><p>They are used for quick, simple operations without needing to define a full function using def.</p></li>
<li><p>In geoscience, where we deal with large datasets (e.g., climate data, seismic measurements), lambda functions allow us to process data efficiently.</p></li>
<li><p>Lambda functions in Pandas allow you to quickly transform, filter, or process this data with minimal code.</p></li>
<li><p>Please read additional tutorials from <span class="xref myst">RealPython</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">1.2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.&lt;lambda&gt;(x)&gt;
</pre></div>
</div>
</div>
</div>
<p>This lambda function multiplies any input <code class="docutils literal notranslate"><span class="pre">x</span></code> by 1.2, which could be useful for tasks like converting units (e.g., from km to m).</p>
<p>Below is an example on how to use lambda in a pandas dataframe.
<strong>Example 1</strong>:
The lambda function lambda <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">(x</span> <span class="pre">-</span> <span class="pre">32)</span> <span class="pre">*</span> <span class="pre">5</span> <span class="pre">/</span> <span class="pre">9</span></code> converts Fahrenheit to Celsius for each value in the Temperature_F column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Sample DataFrame</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Temperature_F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Convert Fahrenheit to Celsius</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature_C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature_F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Temperature_F  Temperature_C
0             32       0.000000
1             50      10.000000
2             77      25.000000
3            100      37.777778
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now the equivalent in lambda is:</span>
<span class="n">lambda_meters2kilometers</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">/</span><span class="mi">1000</span>
<span class="c1"># x is the variable</span>
</pre></div>
</div>
</div>
</div>
<p>Now apply the function to the entire series</p>
<div class="admonition-student-response-section admonition">
<p class="admonition-title">Student response section</p>
<p>This section is left for the student to complete.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply it to the entire series</span>
<span class="n">lambda_meters2kilometers</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        34.40
1        30.10
2        16.90
3       109.40
4        25.70
         ...  
1780     10.00
1781    105.00
1782    608.51
1783     10.00
1784     35.44
Name: depth, Length: 1785, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Lambda functions can take several inputs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can add several variables into lambda functions</span>
<span class="n">remove_anything</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="n">x</span><span class="o">-</span><span class="n">y</span>
<span class="n">remove_anything</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>This did not affect the values of the DataFrame, check it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0        34400.0
1        30100.0
2        16900.0
3       109400.0
4        25700.0
          ...   
1780     10000.0
1781    105000.0
1782    608510.0
1783     10000.0
1784     35440.0
Name: depth, Length: 1785, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Instead, you could overwrite <code class="docutils literal notranslate"><span class="pre">quake.depth=X</span></code>. Try two approaches but just do it once! You can use python functions <code class="docutils literal notranslate"><span class="pre">map</span></code> (a function to apply functions that is generic to Python) and <code class="docutils literal notranslate"><span class="pre">apply</span></code> (a function to apply functions that is specific to Pandas).</p>
<div class="admonition-student-response-section admonition">
<p class="admonition-title">Student response section</p>
<p>This section is left for the student to complete.</p>
</div>
<p>Try <code class="docutils literal notranslate"><span class="pre">map</span></code> to apply a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function that rescale depth from meters to kilometers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#type answer below</span>
<span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">=</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Discuss in class: What happened to the depth field?</p>
<p>What happened to the original data frame?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">apply</span></code> to apply a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function that rescale depth from meters to kilometers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># or like this</span>
<span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">=</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot a histogram of the depth distributions using matplotlib function <code class="docutils literal notranslate"><span class="pre">hist</span></code>.</p>
<div class="admonition-student-response-section admonition">
<p class="admonition-title">Student response section</p>
<p>This section is left for the student to complete.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer here</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">quake</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Quake depth (km)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2.3_pandas_rendered_49_0.png" src="../_images/2.3_pandas_rendered_49_0.png" />
</div>
</div>
<p>You can use the interactive plotting package Plotly. First we will show a histogram of the event depth using the function <code class="docutils literal notranslate"><span class="pre">histogram</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">quake</span><span class="p">,</span>   <span class="c1">#specify what dataframe to use</span>
             <span class="n">x</span><span class="o">=</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span>  <span class="c1">#specify the variable for the histogram </span>
             <span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>       <span class="c1">#number of bins for the histogram </span>
             <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>     <span class="c1">#dimensions of the figure</span>
             <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="example-2-conditional-logic-for-earthquake-magnitude">
<h3>Example 2: Conditional Logic for Earthquake Magnitude<a class="headerlink" href="#example-2-conditional-logic-for-earthquake-magnitude" title="Permalink to this headline">#</a></h3>
<p>You can use lambda functions to add conditional logic, such as classifying earthquake magnitudes into categories.</p>
<p>Scenario: You have a column Magnitude containing seismic event magnitudes, and you want to classify events as “Minor”, “Moderate”, or “Severe”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Classify earthquake magnitudes</span>
<span class="n">quake</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;Minor&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">4.0</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;Moderate&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">6.5</span> <span class="k">else</span> <span class="s1">&#39;Severe&#39;</span><span class="p">))</span>
<span class="n">quake</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>magnitude</th>
      <th>description</th>
      <th>depth_km</th>
      <th>Category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-07-02 06:04:03.570</td>
      <td>-13.6098</td>
      <td>166.6541</td>
      <td>0.0344</td>
      <td>6.3</td>
      <td>VANUATU ISLANDS</td>
      <td>34.4</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-07-04 21:55:52.370</td>
      <td>39.6611</td>
      <td>142.5792</td>
      <td>0.0301</td>
      <td>6.3</td>
      <td>NEAR EAST COAST OF HONSHU</td>
      <td>30.1</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-07-10 11:43:33.000</td>
      <td>11.1664</td>
      <td>146.0823</td>
      <td>0.0169</td>
      <td>6.3</td>
      <td>SOUTH OF MARIANA ISLANDS</td>
      <td>16.9</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010-07-12 00:11:20.060</td>
      <td>-22.2789</td>
      <td>-68.3159</td>
      <td>0.1094</td>
      <td>6.2</td>
      <td>NORTHERN CHILE</td>
      <td>109.4</td>
      <td>Moderate</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010-07-14 08:32:21.850</td>
      <td>-38.0635</td>
      <td>-73.4649</td>
      <td>0.0257</td>
      <td>6.6</td>
      <td>NEAR COAST OF CENTRAL CHILE</td>
      <td>25.7</td>
      <td>Severe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We will now make a new plot of the location of the earthquakes. We will use Plotly tool.</p>
<p>The markersize will be scaled with the earthquake magnitude. To do so, we add a <code class="docutils literal notranslate"><span class="pre">marker_size</span></code> series in the DataFrame</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake</span><span class="p">[</span><span class="s1">&#39;marker_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span> <span class="c1"># add marker size as exp(mag)</span>
<span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span> <span class="c1"># add marker size as exp(mag)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># another way to do it</span>
<span class="n">quake</span><span class="p">[</span><span class="s1">&#39;marker_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">]))</span> <span class="c1"># add marker size as exp(mag)</span>
<span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">quake</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">])</span> <span class="c1"># add marker size as exp(mag)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="intermediate-manipulation-with-pandas">
<h3>1.4 Intermediate Manipulation with Pandas<a class="headerlink" href="#intermediate-manipulation-with-pandas" title="Permalink to this headline">#</a></h3>
<p>You can also apply lambda functions to work with multiple columns, which is common in geoscientific datasets, where you might have spatial or temporal data.</p>
<p><strong>Example 3: Calculating an Index Based on Multiple Measurements</strong>
Scenario: You have rainfall (<code class="docutils literal notranslate"><span class="pre">Rainfall_mm</span></code>) and evaporation (<code class="docutils literal notranslate"><span class="pre">Evaporation_mm</span></code>) data, and you want to calculate the <code class="docutils literal notranslate"><span class="pre">Net</span> <span class="pre">Water</span> <span class="pre">Balance</span> </code>for each record.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Rainfall_mm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="s1">&#39;Evaporation_mm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">65</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Calculate Net Water Balance</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Net_Water_Balance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Rainfall_mm&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Evaporation_mm&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Rainfall_mm  Evaporation_mm  Net_Water_Balance
0          100              60                 40
1           80              70                 10
2          120              65                 55
</pre></div>
</div>
</div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">row:</span> <span class="pre">row['Rainfall_mm']</span> <span class="pre">-</span> <span class="pre">row['Evaporation_mm']</span></code> calculates the net water balance by subtracting evaporation from rainfall for each record.</p>
</section>
<section id="advanced-time-series-data-manipulation-with-lambda-functions">
<h3>1.5 Advanced: Time Series Data Manipulation with Lambda Functions<a class="headerlink" href="#advanced-time-series-data-manipulation-with-lambda-functions" title="Permalink to this headline">#</a></h3>
<p>Geoscientists frequently work with time series data (e.g., climate data). Lambda functions can be used for efficient data transformations within time series.</p>
<p><strong>Example 4: Applying a Rolling Window Calculation</strong>
Scenario: Suppose you have daily temperature data, and you want to calculate a 7-day rolling average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample daily temperature data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2023-09-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Temperature_C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Calculate 7-day rolling average using lambda</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;7_day_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Temperature_C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Temperature_C</th>
      <th>7_day_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-09-01</td>
      <td>20</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-09-02</td>
      <td>22</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-09-03</td>
      <td>23</td>
      <td>21.666667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-09-04</td>
      <td>21</td>
      <td>22.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-09-05</td>
      <td>19</td>
      <td>21.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">x.mean()</span></code> calculates the rolling mean over a 3-day window for temperature data, which is essential in climate analysis for smoothing short-term fluctuations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>### 1.6 Aggregate function

The ``agg``  is a powerful method in Pandas that allows you to perform multiple operations on DataFrames and Series. You can apply one or more aggregation functions such as ``sum``, ``mean``, ``min``, ``max``, etc., on different columns or groups of data.
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>  Cell In[81], line 3
    The ``agg``  is a powerful method in Pandas that allows you to perform multiple operations on DataFrames and Series. You can apply one or more aggregation functions such as ``sum``, ``mean``, ``min``, ``max``, etc., on different columns or groups of data.
        ^
SyntaxError: invalid syntax
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample DataFrame</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Apply aggregation functions</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sum     10.0
mean     2.5
Name: A, dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="aggregating-multiple-columns-with-multiple-functions">
<h4>Aggregating Multiple Columns with Multiple Functions<a class="headerlink" href="#aggregating-multiple-columns-with-multiple-functions" title="Permalink to this headline">#</a></h4>
<p>You can pass a dictionary to agg where the keys are column names and the values are the functions to be applied.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply different functions to different columns</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         A    B
sum   10.0  NaN
mean   2.5  NaN
min    NaN  5.0
max    NaN  8.0
</pre></div>
</div>
</div>
</div>
<p>In this example, column ‘A’ gets <code class="docutils literal notranslate"><span class="pre">sum</span></code> and <code class="docutils literal notranslate"><span class="pre">mean</span></code>, while column ‘B’ gets <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>.</p>
<p>You may also use costum functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Custom function to calculate range (max - min)</span>
<span class="k">def</span> <span class="nf">data_range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="c1"># Apply custom function</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">data_range</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">data_range</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              A    B
mean        2.5  NaN
data_range  3.0  3.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="mapping-using-plotly">
<h2>2.4 Mapping using Plotly<a class="headerlink" href="#mapping-using-plotly" title="Permalink to this headline">#</a></h2>
<p>Now we will plot the earthquakes locations on a map using the Plotly package. More tutorials on <a class="reference external" href="https://plotly.com/">Plotly</a>. The input of the function is self-explanatory and typical of Python’s function. The code <a class="reference external" href="https://plotly.com/python/scatter-plots-on-maps/">documentation</a> of Plotly scatter_geo lists the variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">quake</span><span class="p">,</span>
                     <span class="n">lat</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> 
                     <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span>
                     <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="s1">&#39;marker_size&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
                     <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span><span class="s1">&#39;depth&#39;</span><span class="p">]);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">showcountries</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">showcountries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">projection_type</span><span class="o">=</span><span class="s2">&quot;orthographic&quot;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>The lambda function <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">'Minor'</span> <span class="pre">if</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">4.0</span> <span class="pre">else</span> <span class="pre">('Moderate'</span> <span class="pre">if</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">6.5</span> <span class="pre">else</span> <span class="pre">'Severe')</span></code> classifies earthquake magnitudes based on their values.</p>
<p>The data was sorted by time. We now want to sort and show the data instead by magnitude. We use the pandas function <code class="docutils literal notranslate"><span class="pre">sort</span></code> to create a new DataFrame with sorted values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quakes2plot</span><span class="o">=</span><span class="n">quake</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;magnitude_bin&#39;</span><span class="p">)</span>
<span class="n">quakes2plot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>depth</th>
      <th>magnitude</th>
      <th>description</th>
      <th>depth_km</th>
      <th>Category</th>
      <th>marker_size</th>
      <th>magnitude_bin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-07-02 06:04:03.570</td>
      <td>-13.6098</td>
      <td>166.6541</td>
      <td>0.03440</td>
      <td>6.3</td>
      <td>VANUATU ISLANDS</td>
      <td>34.40</td>
      <td>Moderate</td>
      <td>544.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1112</th>
      <td>2017-08-31 17:06:55.750</td>
      <td>-1.1590</td>
      <td>99.6881</td>
      <td>0.04314</td>
      <td>6.3</td>
      <td>SOUTHERN SUMATRA</td>
      <td>43.14</td>
      <td>Moderate</td>
      <td>544.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1111</th>
      <td>2017-08-27 04:17:51.010</td>
      <td>-1.4513</td>
      <td>148.0803</td>
      <td>0.00800</td>
      <td>6.3</td>
      <td>ADMIRALTY ISLANDS REGION</td>
      <td>8.00</td>
      <td>Moderate</td>
      <td>544.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1110</th>
      <td>2017-08-19 02:00:52.550</td>
      <td>-17.9609</td>
      <td>-178.8406</td>
      <td>0.54400</td>
      <td>6.4</td>
      <td>FIJI ISLANDS REGION</td>
      <td>544.00</td>
      <td>Moderate</td>
      <td>601.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1108</th>
      <td>2017-08-13 03:08:10.560</td>
      <td>-3.7682</td>
      <td>101.6228</td>
      <td>0.03100</td>
      <td>6.4</td>
      <td>SOUTHERN SUMATRA</td>
      <td>31.00</td>
      <td>Moderate</td>
      <td>601.0</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we will plot again using Plotly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">quakes2plot</span><span class="p">,</span>
                     <span class="n">lat</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> 
                     <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span>
                     <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="s1">&#39;marker_size&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span>
                     <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;magnitude&#39;</span><span class="p">,</span><span class="s1">&#39;depth&#39;</span><span class="p">]);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">showcountries</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># fig.update_geos(resolution=110, showcountries=True,projection_type=&quot;orthographic&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="create-a-pandas-from-a-generic-text-file">
<h1>3 Create a Pandas from a generic text file.<a class="headerlink" href="#create-a-pandas-from-a-generic-text-file" title="Permalink to this headline">#</a></h1>
<p>The python package pandas is very useful to read csv files, but also many text files that are more or less formatted as one observation per row and one column for each feature.</p>
<p>As an example, we are going to look at the list of seismic stations from the Northern California seismic network, available <a class="reference external" href="http://ncedc.org/ftp/pub/doc/NC.info/NC.channel.summary.day">here</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://ncedc.org/ftp/pub/doc/NC.info/NC.channel.summary.day&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this gets the file linked in the URL page and convert it to a string</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will convert the string, decode it , and make it a table</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">)))</span>
<span class="c1"># because columns/keys were not assigned, assign them now</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let us look at the data. They are now stored into a pandas dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1976/07/20,17:38:00</td>
      <td>1977/12/01,22:37:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1977/12/01,22:37:00</td>
      <td>1981/06/12,19:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1981/06/12,19:15:00</td>
      <td>1984/01/01,00:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1984/01/01,00:00:00</td>
      <td>1985/11/03,22:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1985/11/03,22:00:00</td>
      <td>1987/03/10,23:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can output the first element of the DataFrame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>station                       AAR
network                        NC
channel                       EHZ
location                       --
rate                          0.0
start_time    1976/07/20,17:38:00
end_time      1977/12/01,22:37:00
latitude                 39.27594
longitude              -121.02696
elevation                   911.0
depth                         0.0
dip                         -90.0
azimuth                       0.0
Name: 0, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the type of each column</span>
<span class="n">data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>station        object
network        object
channel        object
location       object
rate          float64
start_time     object
end_time       object
latitude      float64
longitude     float64
elevation     float64
depth         float64
dip           float64
azimuth       float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0         AAR
1         AAR
2         AAR
3         AAR
4         AAR
         ... 
29434     WMP
29435     WMP
29436     WMP
29437     WSL
29438    WWVB
Name: station, Length: 29439, dtype: object
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">end_time</span></code> are stored as <code class="docutils literal notranslate"><span class="pre">object</span></code> or <code class="docutils literal notranslate"><span class="pre">string</span></code>, convert these columns to datetime objects. With a too-simple prompt, CoPilot may fail at converting:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert start_time and end_time to datetime</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">])</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/js/lzmy975n0l5bjbmr9db291m00000gn/T/ipykernel_7231/3238846712.py:2: UserWarning:

Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">DateParseError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># convert start_time and end_time to datetime</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">])</span>

<span class="nn">File ~/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages/pandas/core/tools/datetimes.py:1108,</span> in <span class="ni">to_datetime</span><span class="nt">(arg, errors, dayfirst, yearfirst, utc, format, exact, unit, infer_datetime_format, origin, cache)</span>
<span class="g g-Whitespace">   </span><span class="mi">1106</span>             <span class="n">result</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;utc&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1107</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ABCSeries</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1108</span>     <span class="n">cache_array</span> <span class="o">=</span> <span class="n">_maybe_cache</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">convert_listlike</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1109</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_array</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1110</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cache_array</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages/pandas/core/tools/datetimes.py:254,</span> in <span class="ni">_maybe_cache</span><span class="nt">(arg, format, cache, convert_listlike)</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span> <span class="n">unique_dates</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_dates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">254</span>     <span class="n">cache_dates</span> <span class="o">=</span> <span class="n">convert_listlike</span><span class="p">(</span><span class="n">unique_dates</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>     <span class="c1"># GH#45319</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span>     <span class="k">try</span><span class="p">:</span>

<span class="nn">File ~/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages/pandas/core/tools/datetimes.py:490,</span> in <span class="ni">_convert_listlike_datetimes</span><span class="nt">(arg, format, name, utc, unit, errors, dayfirst, yearfirst, exact)</span>
<span class="g g-Whitespace">    </span><span class="mi">487</span> <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">format</span> <span class="o">!=</span> <span class="s2">&quot;mixed&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">488</span>     <span class="k">return</span> <span class="n">_array_strptime_with_fallback</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">utc</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">exact</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">490</span> <span class="n">result</span><span class="p">,</span> <span class="n">tz_parsed</span> <span class="o">=</span> <span class="n">objects_to_datetime64ns</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span>     <span class="n">arg</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span>     <span class="n">dayfirst</span><span class="o">=</span><span class="n">dayfirst</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span>     <span class="n">yearfirst</span><span class="o">=</span><span class="n">yearfirst</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span>     <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">495</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">496</span>     <span class="n">allow_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">497</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span> <span class="k">if</span> <span class="n">tz_parsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span>     <span class="c1"># We can take a shortcut since the datetime64 numpy array</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span>     <span class="c1"># is in UTC</span>
<span class="g g-Whitespace">    </span><span class="mi">502</span>     <span class="n">dta</span> <span class="o">=</span> <span class="n">DatetimeArray</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tz_to_dtype</span><span class="p">(</span><span class="n">tz_parsed</span><span class="p">))</span>

<span class="nn">File ~/opt/miniconda3/envs/mlgeo/lib/python3.9/site-packages/pandas/core/arrays/datetimes.py:2346,</span> in <span class="ni">objects_to_datetime64ns</span><span class="nt">(data, dayfirst, yearfirst, utc, errors, allow_object)</span>
<span class="g g-Whitespace">   </span><span class="mi">2343</span> <span class="c1"># if str-dtype, convert</span>
<span class="g g-Whitespace">   </span><span class="mi">2344</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2346</span> <span class="n">result</span><span class="p">,</span> <span class="n">tz_parsed</span> <span class="o">=</span> <span class="n">tslib</span><span class="o">.</span><span class="n">array_to_datetime</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2347</span>     <span class="n">data</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2348</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2349</span>     <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2350</span>     <span class="n">dayfirst</span><span class="o">=</span><span class="n">dayfirst</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2351</span>     <span class="n">yearfirst</span><span class="o">=</span><span class="n">yearfirst</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2352</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2354</span> <span class="k">if</span> <span class="n">tz_parsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2355</span>     <span class="c1"># We can take a shortcut since the datetime64 numpy array</span>
<span class="g g-Whitespace">   </span><span class="mi">2356</span>     <span class="c1">#  is in UTC</span>
<span class="g g-Whitespace">   </span><span class="mi">2357</span>     <span class="c1"># Return i8 values to denote unix timestamps</span>
<span class="g g-Whitespace">   </span><span class="mi">2358</span>     <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">),</span> <span class="n">tz_parsed</span>

<span class="nn">File tslib.pyx:403,</span> in <span class="ni">pandas._libs.tslib.array_to_datetime</span><span class="nt">()</span>

<span class="nn">File tslib.pyx:552,</span> in <span class="ni">pandas._libs.tslib.array_to_datetime</span><span class="nt">()</span>

<span class="nn">File tslib.pyx:517,</span> in <span class="ni">pandas._libs.tslib.array_to_datetime</span><span class="nt">()</span>

<span class="nn">File conversion.pyx:546,</span> in <span class="ni">pandas._libs.tslibs.conversion.convert_str_to_tsobject</span><span class="nt">()</span>

<span class="nn">File parsing.pyx:331,</span> in <span class="ni">pandas._libs.tslibs.parsing.parse_datetime_string</span><span class="nt">()</span>

<span class="nn">File parsing.pyx:660,</span> in <span class="ni">pandas._libs.tslibs.parsing.dateutil_parse</span><span class="nt">()</span>

<span class="ne">DateParseError</span>: Unknown datetime string format, unable to parse: 1976/07/20,17:38:00, at position 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">,%H:%M:%S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
      <th>startdate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1976/07/20,17:38:00</td>
      <td>1977/12/01,22:37:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1976-07-20 17:38:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1977/12/01,22:37:00</td>
      <td>1981/06/12,19:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1977-12-01 22:37:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1981/06/12,19:15:00</td>
      <td>1984/01/01,00:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1981-06-12 19:15:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1984/01/01,00:00:00</td>
      <td>1985/11/03,22:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1984-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1985/11/03,22:00:00</td>
      <td>1987/03/10,23:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1985-11-03 22:00:00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># do the same for end times</span>
<span class="c1"># Avoid &#39;OutOfBoundsDatetime&#39; error with year 3000</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;3000&#39;</span><span class="p">,</span> <span class="s1">&#39;2026&#39;</span><span class="p">)</span>
<span class="n">enddate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">,%H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;enddate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enddate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
      <th>startdate</th>
      <th>enddate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1976/07/20,17:38:00</td>
      <td>1977/12/01,22:37:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1976-07-20 17:38:00</td>
      <td>1977-12-01 22:37:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1977/12/01,22:37:00</td>
      <td>1981/06/12,19:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1977-12-01 22:37:00</td>
      <td>1981-06-12 19:15:00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1981/06/12,19:15:00</td>
      <td>1984/01/01,00:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1981-06-12 19:15:00</td>
      <td>1984-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1984/01/01,00:00:00</td>
      <td>1985/11/03,22:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1984-01-01 00:00:00</td>
      <td>1985-11-03 22:00:00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1985/11/03,22:00:00</td>
      <td>1987/03/10,23:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
      <td>1985-11-03 22:00:00</td>
      <td>1987-03-10 23:15:00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Use Plotly to map the stations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">longitude</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                     <span class="n">lat</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> 
                     <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span>
                     <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;station&quot;</span><span class="p">,</span>
                     <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">,</span><span class="s1">&#39;station&#39;</span><span class="p">,</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">]);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span> <span class="n">showcountries</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                     <span class="n">lat</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> 
                     <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;carto-positron&quot;</span><span class="p">,</span>
                     <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                     <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;station&quot;</span><span class="p">,</span>
                     <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">,</span><span class="s1">&#39;station&#39;</span><span class="p">,</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">]);</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Northern California Seismic Network&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercise">
<h1>4: Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">#</a></h1>
<p>We will now practice on manipulating pandas. This exercise pulls station metadata from a URL and students are expected to practice on specific tasks.</p>
<p>Download data from the NCEDC URL</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://ncedc.org/ftp/pub/doc/NC.info/NC.channel.summary.day&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>The column names are shown at the top of the text file, make a list of strings of these names  in order to rename the columns once the dataframe is made</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
<span class="c1"># request the data from the URL and use the IO package</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1976/07/20,17:38:00</td>
      <td>1977/12/01,22:37:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1977/12/01,22:37:00</td>
      <td>1981/06/12,19:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>0.0</td>
      <td>1981/06/12,19:15:00</td>
      <td>1984/01/01,00:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1984/01/01,00:00:00</td>
      <td>1985/11/03,22:00:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAR</td>
      <td>NC</td>
      <td>EHZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>1985/11/03,22:00:00</td>
      <td>1987/03/10,23:15:00</td>
      <td>39.27594</td>
      <td>-121.02696</td>
      <td>911.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign the column names</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">,</span> <span class="s1">&#39;azimuth&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Find the row of channel KCPB</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find the row of station KCPB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15600</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>1999/08/03,00:00:00</td>
      <td>2000/06/06,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15601</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,00:00:00</td>
      <td>2000/06/06,16:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15602</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15603</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/07/12,00:00:00</td>
      <td>2002/01/24,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15604</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2002/01/24,00:00:00</td>
      <td>2002/01/24,23:50:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15728</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>MNE</td>
      <td>--</td>
      <td>10.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15729</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>MNN</td>
      <td>--</td>
      <td>10.0</td>
      <td>1999/08/03,00:00:00</td>
      <td>2000/06/06,16:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15730</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>MNN</td>
      <td>--</td>
      <td>10.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15731</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>MNZ</td>
      <td>--</td>
      <td>10.0</td>
      <td>1999/08/03,00:00:00</td>
      <td>2000/06/06,16:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15732</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>MNZ</td>
      <td>--</td>
      <td>10.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>133 rows × 13 columns</p>
</div></div></div>
</div>
<p>Now select two stations of your choice using <code class="docutils literal notranslate"><span class="pre">|</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer below</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15600</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>1999/08/03,00:00:00</td>
      <td>2000/06/06,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15601</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,00:00:00</td>
      <td>2000/06/06,16:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15602</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15603</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/07/12,00:00:00</td>
      <td>2002/01/24,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15604</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2002/01/24,00:00:00</td>
      <td>2002/01/24,23:50:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16345</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VFP</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16346</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VKI</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16347</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMU</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>16348</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMV</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>16349</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMW</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>210.0</td>
    </tr>
  </tbody>
</table>
<p>228 rows × 13 columns</p>
</div></div></div>
</div>
<p>Now select a given station and a specific channel code, example is <code class="docutils literal notranslate"><span class="pre">KCPB</span></code> and channel code <code class="docutils literal notranslate"><span class="pre">HNZ</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select two stations, use the typical &quot;AND&quot; </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15701</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2002/10/17,00:00:00</td>
      <td>2006/06/26,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15702</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2006/06/26,00:00:00</td>
      <td>2006/10/18,00:08:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15703</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2006/10/18,00:08:00</td>
      <td>2006/10/19,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15704</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2006/10/19,00:00:00</td>
      <td>2006/11/14,23:30:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15705</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2006/11/14,23:30:00</td>
      <td>2010/11/01,22:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15706</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2010/11/01,22:00:00</td>
      <td>2011/07/13,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15707</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2011/07/13,00:00:00</td>
      <td>2011/09/07,19:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15708</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2011/09/07,19:00:00</td>
      <td>2015/10/29,18:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2015/10/29,18:00:00</td>
      <td>2016/04/28,16:39:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15710</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2016/04/28,16:39:00</td>
      <td>2019/09/13,17:30:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15711</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>HNZ</td>
      <td>--</td>
      <td>100.0</td>
      <td>2019/09/13,17:30:00</td>
      <td>2022/11/15,18:19:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>-90.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You may also choose the pandas function <code class="docutils literal notranslate"><span class="pre">isin</span></code> to select rows that have a given attribute that belongs to a list. For instance, use <code class="docutils literal notranslate"><span class="pre">isin</span></code> to select all rows that have the key <code class="docutils literal notranslate"><span class="pre">station</span></code> within a list <code class="docutils literal notranslate"><span class="pre">['KCBP','KHBB'</span> <span class="pre">]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  students answer here</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>network</th>
      <th>channel</th>
      <th>location</th>
      <th>rate</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>elevation</th>
      <th>depth</th>
      <th>dip</th>
      <th>azimuth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15600</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>1999/08/03,00:00:00</td>
      <td>2000/06/06,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15601</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,00:00:00</td>
      <td>2000/06/06,16:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15602</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/06/06,16:00:00</td>
      <td>2000/07/12,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15603</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2000/07/12,00:00:00</td>
      <td>2002/01/24,00:00:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>15604</th>
      <td>KCPB</td>
      <td>NC</td>
      <td>BHE</td>
      <td>--</td>
      <td>50.0</td>
      <td>2002/01/24,00:00:00</td>
      <td>2002/01/24,23:50:00</td>
      <td>39.68631</td>
      <td>-123.58242</td>
      <td>1261.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16345</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VFP</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16346</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VKI</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16347</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMU</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>16348</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMV</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>16349</th>
      <td>KHBB</td>
      <td>NC</td>
      <td>VMW</td>
      <td>--</td>
      <td>0.1</td>
      <td>2022/08/09,18:00:00</td>
      <td>3000/01/01,00:00:00</td>
      <td>40.65990</td>
      <td>-123.21966</td>
      <td>1864.0</td>
      <td>0.0</td>
      <td>-54.7</td>
      <td>210.0</td>
    </tr>
  </tbody>
</table>
<p>228 rows × 13 columns</p>
</div></div></div>
</div>
<p><strong>Q</strong> Use panda native functions to calculate how many unique sites (station names) there are in the network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q</strong> Use pandas native functions to select the unique set of channel codes that end with <code class="docutils literal notranslate"><span class="pre">Z</span></code>: this will tell you of how many types digitized data the seismic network manages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q</strong> What station names has the most number of channels? <strong>hint</strong> you may use <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KCPB    78
JSGB    73
KMPB    72
KHMB    63
CCH1    60
        ..
LAMB     1
LBA      1
PBY      1
MCW      1
MMW      1
Name: station, Length: 905, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>Q</strong> What is the maximum difference in elevation between the stations using lambda functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
</div>
<p>Here, pandas does not recognize the start_time and end_time columns as a datetime format, so we cannot use datetime operations on them. We first need to convert these columns into a datetime format:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Transform column from string into datetime format</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      1984-01-01 00:00:00
1      1987-05-01 00:00:00
2      1994-11-28 00:00:00
3      1984-11-27 18:45:00
4      1987-05-01 00:00:00
               ...        
7150   1995-07-02 12:00:00
7151   1995-07-02 12:00:00
7152   1995-03-02 19:00:00
7153   1995-07-02 12:00:00
7154   1995-07-02 12:00:00
Name: start_time, Length: 7136, dtype: datetime64[ns]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas._libs.tslibs.timestamps.Timestamp
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># do the same for end times</span>
</pre></div>
</div>
</div>
</div>
<p>We can now look when each seismic station was installed using <code class="docutils literal notranslate"><span class="pre">groupby</span></code> and sorting by the earliest deployment (i.e., the minimum of the start_time)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># students answer here</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>station
AAR   1984-01-01 00:00:00
AAS   1984-11-27 18:45:00
ABJ   1984-01-01 00:00:00
ABR   1984-01-01 00:00:00
ADW   1984-01-01 00:00:00
              ...        
VCL   1984-01-01 00:00:00
VRC   1993-09-23 22:20:00
VSP   1993-09-24 22:05:00
VWB   1985-01-01 00:00:00
WMP   1995-03-02 19:00:00
Length: 905, dtype: datetime64[ns]
</pre></div>
</div>
</div>
</div>
<p>Select the stations that were deployed first and recovered last using <code class="docutils literal notranslate"><span class="pre">agg</span></code> and lambda functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># answer here</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>end_time</th>
    </tr>
    <tr>
      <th>station</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AAR</th>
      <td>1984-01-01 00:00:00</td>
      <td>2006-01-04 19:19:00</td>
    </tr>
    <tr>
      <th>AAS</th>
      <td>1984-11-27 18:45:00</td>
      <td>2021-08-13 16:50:00</td>
    </tr>
    <tr>
      <th>ABJ</th>
      <td>1984-01-01 00:00:00</td>
      <td>2019-06-26 19:17:00</td>
    </tr>
    <tr>
      <th>ABR</th>
      <td>1984-01-01 00:00:00</td>
      <td>1997-08-04 21:02:00</td>
    </tr>
    <tr>
      <th>ADW</th>
      <td>1984-01-01 00:00:00</td>
      <td>2006-04-20 01:08:00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VCL</th>
      <td>1984-01-01 00:00:00</td>
      <td>1985-03-25 21:30:00</td>
    </tr>
    <tr>
      <th>VRC</th>
      <td>1993-09-23 22:20:00</td>
      <td>2001-07-12 16:50:00</td>
    </tr>
    <tr>
      <th>VSP</th>
      <td>1993-09-24 22:05:00</td>
      <td>2001-07-12 16:50:00</td>
    </tr>
    <tr>
      <th>VWB</th>
      <td>1985-01-01 00:00:00</td>
      <td>1985-03-25 19:00:00</td>
    </tr>
    <tr>
      <th>WMP</th>
      <td>1995-03-02 19:00:00</td>
      <td>2002-05-08 22:30:00</td>
    </tr>
  </tbody>
</table>
<p>905 rows × 2 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="csv-vs-parquet">
<h1>4. CSV vs Parquet<a class="headerlink" href="#csv-vs-parquet" title="Permalink to this headline">#</a></h1>
<p>Parquet is a compressed data format that stores and compresses the columns. It is fast for I/O and compact format.</p>
<p>Save <code class="docutils literal notranslate"><span class="pre">data</span></code> into a CSV file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> data.to_csv(&quot;my_metadata.csv&quot;)
<span class="o">!</span>ls -lh my_metadata.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>66.6 ms ± 4.45 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ls&#39; is not recognized as an internal or external command,
operable program or batch file.
</pre></div>
</div>
</div>
</div>
<p>Try and save in Parquet and compare time and memory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> data.to_parquet(&quot;my_metadata.pq&quot;)
<span class="o">!</span>ls -lh my_metadata.pq
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter2-DataManipulation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="2.2_data_formats_rendered.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2.2 Data Formats</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2.4_Arrays.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2.4 Data Arrays</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By eScience Institute, University of Washington<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>